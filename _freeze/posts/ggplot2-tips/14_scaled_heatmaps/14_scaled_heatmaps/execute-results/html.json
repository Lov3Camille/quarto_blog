{
  "hash": "9bacca38a96f66e8676bbb8aac02aece",
  "result": {
    "markdown": "---\ntitle: \"Forget regular heat maps. Use bubbles on a grid!\"\ndate: '2022-08-10'\ncategories: [\"Visualization\"]\ndescription: \"We explore alternatives for heat maps to take sample sizes into account.\"\nexecute: \n  message: false\n  warning: false\n  collapse: false\neditor_options: \n  chunk_output_type: console\n  markdown: \n    wrap: 80\n---\n\n::: {.cell}\n\n:::\n\n\nHeat maps are super easy to understand. \nAnd even better: \nThey can be generated in warp speed with `geom_tile()`. \nCombine that with `facet_wrap()` and you can even build special heat maps.\nThat's how I created this calendar plot I shared [on Twitter](https://twitter.com/rappa753/status/1545729747774308354) a few days ago.\n\n::: {.grid}\n\n::: {.g-col-8 .g-start-3}\n![](nycflights_calendar.png)\n:::\n\n:::\n\nIn this particular case, using heat maps feels apprpropriate.\nEach day has the exact same ¨weight\" in the data.\nSure, each day may see a different amount of flights.\nBut that's exactly what the color gradient shows.\nSo, there are no bad surprises here.\n\nHowever, it's not always this simple.\nTake a look at the following heat map.\nIt tries to visualize the effect of a property's size and it's location (zone) on a House's sale price.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/regular_heatmap-1.png){width=672}\n:::\n:::\n\n\n## The Problem with heat maps\n\nJudging from this visual you could think that the information in each tile is in some sense equal.\nFor starters, you could assume that a similar amount of information went into estimating the median. \nBut this is not the case!\nIn each tile, there's a different group size.\nTake a look!\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"ikjwmquned\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#ikjwmquned .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ikjwmquned .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ikjwmquned .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ikjwmquned .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ikjwmquned .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ikjwmquned .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ikjwmquned .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ikjwmquned .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ikjwmquned .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ikjwmquned .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ikjwmquned .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ikjwmquned .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ikjwmquned .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ikjwmquned .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ikjwmquned .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ikjwmquned .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ikjwmquned .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ikjwmquned .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ikjwmquned .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ikjwmquned .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ikjwmquned .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ikjwmquned .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ikjwmquned .gt_left {\n  text-align: left;\n}\n\n#ikjwmquned .gt_center {\n  text-align: center;\n}\n\n#ikjwmquned .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ikjwmquned .gt_font_normal {\n  font-weight: normal;\n}\n\n#ikjwmquned .gt_font_bold {\n  font-weight: bold;\n}\n\n#ikjwmquned .gt_font_italic {\n  font-style: italic;\n}\n\n#ikjwmquned .gt_super {\n  font-size: 65%;\n}\n\n#ikjwmquned .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#ikjwmquned .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#ikjwmquned .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ikjwmquned .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#ikjwmquned .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#ikjwmquned .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\">lot_area</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">ms_zoning</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">n</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_center\">1,300 - 4,800</td>\n<td class=\"gt_row gt_left\">Floating\nVillage\nResidential</td>\n<td class=\"gt_row gt_right\">59</td></tr>\n    <tr><td class=\"gt_row gt_center\">1,300 - 4,800</td>\n<td class=\"gt_row gt_left\">Residential\nHigh\nDensity</td>\n<td class=\"gt_row gt_right\">6</td></tr>\n    <tr><td class=\"gt_row gt_center\">1,300 - 4,800</td>\n<td class=\"gt_row gt_left\">Residential\nLow\nDensity</td>\n<td class=\"gt_row gt_right\">83</td></tr>\n    <tr><td class=\"gt_row gt_center\">1,300 - 4,800</td>\n<td class=\"gt_row gt_left\">Residential\nMedium\nDensity</td>\n<td class=\"gt_row gt_right\">146</td></tr>\n    <tr><td class=\"gt_row gt_center\">4,800 - 8,740</td>\n<td class=\"gt_row gt_left\">Floating\nVillage\nResidential</td>\n<td class=\"gt_row gt_right\">44</td></tr>\n    <tr><td class=\"gt_row gt_center\">4,800 - 8,740</td>\n<td class=\"gt_row gt_left\">Residential\nHigh\nDensity</td>\n<td class=\"gt_row gt_right\">13</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nSo, this visualization is somewhat misleading.\nLet's try to fix that.\nInstead of a heat map, we could generate a bubble chart like this.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/bubble_grid_plot-1.png){width=672}\n:::\n:::\n\n\nNotice how small some bubbles are. This is how you can tell that your summary\nstatistic (in this case the median) may use a rather small sample size. And as\nwe all know, this is not a good thing.\n\nAlso, the bubbles leave a lot of white space. \nWe could use some of this additional space to make our plot more informative. \nFor example, we could label the bubbles with the sample size or the median sale price.\n\n::: panel-tabset\n\n### Only sample size\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/bubble_grid_plot_w_size-1.png){width=672}\n:::\n:::\n\n\n### With Median\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/bubble_grid_plot_with_size_and_median-1.png){width=672}\n:::\n:::\n\n\n:::\n\n\n\n## Conclusion\n\nGridded bubble charts look nice and they are an excellent way to show it all.\nThe colors show a summary statistic and the bubbles show the corresponding sample size.\nAdd some labels to that and everything becomes even more explicit.\n\nThough, I'm still a bit torn about whether labels for sample size **and** medians aren't a bit too much.\nWhat do you think? \nFeel free to let me know in the comments.\n\nIf you want to find out how to generate these plots with `{ggplot2}`, you can check out the Appendix at the end of this blog post.\nSimply, unfold the `Appendix` section.\n\nAlso, if you have any questions, let me know via mail or in the comments.\nAnd don't forget to stay in touch via my\n[Newsletter](https://alberts-newsletter.beehiiv.com/subscribe),\n[Twitter](https://twitter.com/rappa753) or my [RSS\nfeed](https://albert-rapp.de/blog.xml). \nSee you next time!\n\n\n## How to generate the plots\n\n<details>\n<summary> Appendix (click to unfold) </summary>\n\n\n### Data preprocessing\n\nFirst, we need to create a data set.\nHere, the `ames` data set from the `modeldata` package will give us what we need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(ames, package = 'modeldata')\nlibrary(tidyverse)\n\nprice_by_size_and_zones <- ames |> \n  janitor::clean_names() |> \n  select(sale_price, lot_area, ms_zoning) |> \n  filter(!str_detect(ms_zoning, \"(A_agr|I_all|C_all)\")) |> \n  mutate(ms_zoning = fct_drop(ms_zoning)) # Filter out small zones\n```\n:::\n\n\n\nTo create a regular heat map, we first need to bin the lot area.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprice_by_binned_size_and_zones <- price_by_size_and_zones |> \n  mutate(\n    lot_area = cut(\n      lot_area, \n      breaks = quantile(lot_area, probs = c(0, 0.1, 0.4, 0.5, 0.6, 0.8, 1)),\n      include.lowest = T\n    )\n  ) |> \n  mutate(\n    ms_zoning = str_replace_all(ms_zoning, \"_\", \"\\n\")\n  )\nprice_by_binned_size_and_zones\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,901 × 3\n   sale_price lot_area            ms_zoning                   \n        <int> <fct>               <chr>                       \n 1     215000 (1.22e+04,2.15e+05] \"Residential\\nLow\\nDensity\" \n 2     105000 (1.02e+04,1.22e+04] \"Residential\\nHigh\\nDensity\"\n 3     172000 (1.22e+04,2.15e+05] \"Residential\\nLow\\nDensity\" \n 4     244000 (1.02e+04,1.22e+04] \"Residential\\nLow\\nDensity\" \n 5     189900 (1.22e+04,2.15e+05] \"Residential\\nLow\\nDensity\" \n 6     195500 (9.46e+03,1.02e+04] \"Residential\\nLow\\nDensity\" \n 7     213500 (4.8e+03,8.74e+03]  \"Residential\\nLow\\nDensity\" \n 8     191500 (4.8e+03,8.74e+03]  \"Residential\\nLow\\nDensity\" \n 9     236500 (4.8e+03,8.74e+03]  \"Residential\\nLow\\nDensity\" \n10     189000 (4.8e+03,8.74e+03]  \"Residential\\nLow\\nDensity\" \n# … with 2,891 more rows\n# ℹ Use `print(n = ...)` to see more rows\n```\n:::\n:::\n\n\nNext, we estimate the median sale price for a given lot size and zone.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedians_by_binned_size_and_zones <- price_by_binned_size_and_zones |> \n  group_by(ms_zoning, lot_area) |> \n  summarise(\n    n = n(),\n    sale_price = median(sale_price), \n    .groups = 'drop'\n  ) |> \n  complete(lot_area, ms_zoning) \n```\n:::\n\n\nThe lot area labels will look terrible. That's why I have transformed them with\na custom function. But this is beside the point here, so you can skip this step.\nIf you want to see the custom function, though, feel free to unfold the\nfollowing code chunk.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nname_function <- function(text) {\n  text %>% \n    str_remove_all('[ () \\\\[ \\\\] ]') %>% \n    str_split(',') %>% \n    map(as.numeric) %>% \n    map(scales::number, big.mark = \",\") %>% \n    map_chr(paste, collapse = ' - ')\n}\n\n# Better labels\nmedians_by_binned_size_and_zones <- medians_by_binned_size_and_zones |> \n  mutate(lot_area = map_chr(lot_area, name_function)) \n\n# Convert labels to ordered factor\nmedians_by_binned_size_and_zones <- medians_by_binned_size_and_zones |> \n  mutate(\n    lower = str_match(lot_area, \"\\\\d+,\\\\d+\")[,1],\n    lower = as.numeric(str_remove(lower, ',')),\n    lot_area = fct_reorder(lot_area, lower)\n  ) |> \n  select(-lower)\n```\n:::\n\n\n### Regular heat map\n\nNow, we can build the regular heat map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedians_by_binned_size_and_zones  |> \n  ggplot(aes(x = ms_zoning, y = lot_area, fill = sale_price)) +\n  geom_tile(col = 'black') +\n  theme_minimal() +\n  theme(\n    legend.position = 'top',\n    text = element_text(color = 'grey40')\n  ) +\n  guides(\n    fill = guide_colorbar(\n      barheight = unit(0.5, 'cm'),\n      barwidth = unit(10, 'cm'),\n      title.position = 'top'\n    )\n  ) +\n  coord_cartesian(expand = F) +\n  scale_fill_viridis_c(\n    trans = \"log\", \n    labels = scales::label_dollar(),\n    na.value = 'grey80'\n  ) +\n  labs(\n    x = element_blank(), \n    y = 'Lot area (in sq.ft)', \n    fill = 'Median sale price',\n    caption = \"Data: Ames housing data set from {modeldata}\"\n  )\n```\n\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/regular_heatmap-1.png){width=672}\n:::\n:::\n\n\n### Bubble chart\n\nHere's how to create the bubble chart.\nThe trick is to use `geom_point()` and map `size` to the sample size `n`.\nYou can adjust the maximal bubble size via `scale_size_area()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbubble_grid_plot <- medians_by_binned_size_and_zones |> \n  ggplot(aes(x = ms_zoning, y = lot_area)) +\n  geom_point(\n    aes(col = sale_price, fill = sale_price, size = n), shape = 21\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = 'top',\n    text = element_text(color = 'grey40')\n  ) +\n  guides(\n    col = guide_none(),\n    size = guide_none(),\n    fill = guide_colorbar(\n      barheight = unit(0.5, 'cm'),\n      barwidth = unit(10, 'cm'),\n      title.position = 'top'\n    )\n  ) +\n  scale_size_area(max_size = 15) +\n  scale_color_viridis_c(\n    trans = \"log\", \n    labels = scales::label_dollar(),\n    na.value = 'grey80'\n  ) +\n  scale_fill_viridis_c(\n    trans = \"log\", \n    labels = scales::label_dollar(),\n    na.value = 'grey80'\n  ) +\n  labs(x = element_blank(), y = 'Lot area (in sq.ft)', fill = 'Median sale price')\nbubble_grid_plot\n```\n\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/bubble_grid_plot-1.png){width=672}\n:::\n:::\n\n\n\nFor additional text labels use `geom_text()`.\nPositioning the labels so that they do not overlap with the bubbles is a bit tricky.\nI've hard-coded the labels' positions based on the sample size `n` with `case_when()`.\n\n::: panel-tabset\n### Only sample size\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbubble_grid_plot_w_size <- bubble_grid_plot +\n  geom_text(\n    aes(label = n), \n    nudge_x = case_when(\n      medians_by_binned_size_and_zones$n > 225 ~ 0.2, \n      medians_by_binned_size_and_zones$n > 100 ~ 0.135,\n      medians_by_binned_size_and_zones$n > 40 ~ 0.08,\n      T ~ 0.05\n    ), \n    nudge_y = 0.05, hjust = 0, vjust = 0, size = 2.5,\n    col = 'grey40'\n  ) +\n  labs(\n    caption = 'Data: Ames housing data set from {modeldata} | Labels represent sample size'\n  )\nbubble_grid_plot_w_size\n```\n\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/bubble_grid_plot_w_size-1.png){width=672}\n:::\n:::\n\n\n### With Median\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbubble_grid_plot_w_size +\n  geom_text(\n    aes(label = scales::dollar(sale_price, scale_cut = c(0, \"k\" = 1000), accuracy = 0.1)), \n    nudge_x = -case_when(\n      medians_by_binned_size_and_zones$n > 225 ~ 0.2, \n      medians_by_binned_size_and_zones$n > 100 ~ 0.135,\n      medians_by_binned_size_and_zones$n > 40 ~ 0.08,\n      T ~ 0.05\n    ), \n    nudge_y = 0.05, hjust = 1, vjust = 0, size = 2.5,\n    col = 'grey40'\n  ) +\n  labs(\n    caption = 'Data: Ames housing data set from {modeldata} | Labels represent median and sample size'\n  )\n```\n\n::: {.cell-output-display}\n![](14_scaled_heatmaps_files/figure-html/bubble_grid_plot_with_size_and_median-1.png){width=672}\n:::\n:::\n\n:::\n\n\n</details>",
    "supporting": [
      "14_scaled_heatmaps_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}